<!doctype html>
<html>
<head>
  <title>propeR visualisation tool</title>
  <meta charset="utf-8" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link rel="stylesheet" href="css/corner_ribbons.css">

  <style>

  footer {
    position: fixed;
    padding-left: 20px;
    padding-top: 5px;
    padding-right: 5px;
    padding-bottom: 5px;
    height: 10%;
    bottom: 0;
    right: 0;
    left: 0;
    background: white;
    font-family: "Palatino";
    color: #333;
    text-align: right;
  }

  #map {
    position: absolute;
    height: 90%;
    width: 100%;
    background-color: white;
  }

  .text {
    display: inline-block;
    vertical-align: middle; /* or top or bottom */
  }

  #footerimg {
    display: inline-block;
    vertical-align: middle;
    height: 100%;
    padding-left: 20px;
  }

  </style>

</head>
<body>

  <div class="container">
    <div class="corner-ribbon top-left sticky red shadow"><a href="https://github.com/datasciencecampus/access-to-services/tree/develop/propeR" style="color: white; text-decoration:none">propeR Demo</a></div>
    <div id="map"></div>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js"></script>

    <!-- <script src="js/leaflet.select-layers.min.js"></script> -->

    <script>

    var data_attrib = " | Data: <a href='http://www.openstreetmap.org/'>&copy; OpenStreetMap </a>contributers | <a href='http://d3js.org/'>D3.js</a>"
    var osm_bw = L.tileLayer('https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
      attribution: "Map: <a href='https://www.openstreetmap.org/copyright'>&copy; OpenStreetMap</a>" + data_attrib});
    var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: "Map: <a href='http://www.openstreetmap.org/'>&copy; OpenStreetMap </a>contributers" + data_attrib});
    var CartoDB_DarkMatter = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19});
    var CartoDB_LightMatter = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19});

    var baseLayers = {
      "CartoDB Light Matter": CartoDB_LightMatter,
      "CartoDB Dark Matter": CartoDB_DarkMatter,
      "OpenStreetMap": osm,
      "OpenStreetMap (B&W)": osm_bw
    };

    lsoa_wales_points = new L.GeoJSON.AJAX("data/LSOA_Wales.geojson", {
      pointToLayer: function (feature, latlng) {
        return L.circle(latlng,
          radius = 500, {
            color: 'black',
            fillColor: 'white',
            weight:'1',
            fillOpacity:'1'
          })
        },
        onEachFeature: lsoaPopUp
      });

      lsoa_manchester_points = new L.GeoJSON.AJAX("data/LSOA_GM.geojson", {
        pointToLayer: function (feature, latlng) {
          return L.circle(latlng,
            radius = 50, {
              color: 'black',
              fillColor: 'white',
              weight:'1',
              fillOpacity:'1'
            })
          },
          onEachFeature: lsoaPopUp
        });

        jc_points = new L.GeoJSON.AJAX("data/Wales_job_centre_locations.geojson", {
          onEachFeature: jobCentrePopUp
        });


        jc_polygons = new L.GeoJSON.AJAX("data/Wales_job_centre_poly.geojson", {
          style: {
            "color": '#006c84',
            "weight": 0,
            "opacity":0.5
          },
          onEachFeature: polyPopUp
        });

        sports_stadiums = new L.GeoJSON.AJAX("data/Wales_sports_stadiums.geojson", {
          onEachFeature: sportsStadiumPopUp
        });


        sports_stadiums_polygons = new L.GeoJSON.AJAX("data/Wales_sports_stadiums_poly.geojson", {
          style: {
            "color": '#007a72',
            "weight": 0,
            "opacity":0.5
          },
          onEachFeature: polyPopUp
        });

        manchester_points = new L.GeoJSON.AJAX("data/Manchester_centre.geojson", {
          onEachFeature: originPopUp
        });


        manchester_polygons1 = new L.GeoJSON.AJAX("data/Manchester_fri_6pm_poly.geojson", {
          style: {
            "color": '#007a72',
            "weight": 0,
            "opacity":0.5
          },
          onEachFeature: polyPopUp
        });

        manchester_polygons2 = new L.GeoJSON.AJAX("data/Manchester_fri_10pm_poly.geojson", {
          style: {
            "color": '#007a45',
            "weight": 0,
            "opacity":0.5
          },
          onEachFeature: polyPopUp
        });

        manchester_polygons3 = new L.GeoJSON.AJAX("data/Manchester_sat_2am_poly.geojson", {
          style: {
            "color": '#65007a',
            "weight": 0,
            "opacity":0.5
          },
          onEachFeature: polyPopUp
        });

        ons_to_cardiff_markers = new L.GeoJSON.AJAX("data/Cardiff_and_ONS_markers.geojson", {
          onEachFeature: originPopUp
        });


        ons_to_cardiff_journey = new L.GeoJSON.AJAX("data/Cardiff_and_ONS_journey.geojson", {
          style: function(feature) {
            switch (feature.properties.mode) {
              case 'TRANSIT': return {color: '#000000'};
              case 'WALK': return {color: '#A14296'};
              case 'BUS': return {color: '#48C1B1'};
              case 'RAIL': return {color: '#4D7BC5'};
              case 'CAR': return {color: '#E825D6'};
              case 'CYCLE': return {color: '#4AA6C3'};
            }
          },
          onEachFeature: pointToPointPopup
        });

        var job_centres = L.layerGroup([jc_polygons, jc_points])
        var sports = L.layerGroup([sports_stadiums_polygons, sports_stadiums]);
        var manchester1 = L.layerGroup([manchester_polygons1, manchester_points]);
        var manchester2 = L.layerGroup([manchester_polygons2, manchester_points]);
        var manchester3 = L.layerGroup([manchester_polygons3, manchester_points]);
        var ons_to_cardiff = L.layerGroup([ons_to_cardiff_markers, ons_to_cardiff_journey]);

        var map = L.map('map', {
          center: [52.5, -4],
          zoom: 8,
          layers: [CartoDB_LightMatter]
        });

        var overlayLayers = {
          "Wales LSOAs": lsoa_wales_points,
          "Wales Job Centres": job_centres,
          "Wales Sports Stadiums": sports,
          "ONS to Cardiff": ons_to_cardiff,
          "Manchester LSOAs": lsoa_manchester_points,
          "Manchester (Fri 11th Jan 6pm)": manchester1,
          "Manchester (Fri 11th Jan 10pm)": manchester2,
          "Manchester (Sat 11th Jan 2am)": manchester3
        };

        var control = L.control.layers(baseLayers, overlayLayers)
        // console.log(control)
        control.addTo(map);

        function mapPoint(point){
          return [point[1],point[0]]
        }

        function mapPolygon(poly){
          return poly.map(function(line){return mapLineString(line)})
        }

        function mapLineString(line){
          return line.map(function(d){return [d[1],d[0]]})
        }

        function getLineColor(feature, layer) {
          console.log(layer.feature)
          return layer.feature.properties.mode == 'TRANSIT'    ?    '#000000':
          layer.feature.properties.mode == 'WALK'     ?   '#A14296':
          layer.feature.properties.mode == 'BUS'     ?   '#48C1B1':
          layer.feature.properties.mode == 'RAIL'     ?   '#4D7BC5':
          layer.feature.properties.mode == 'CAR'     ?   '#E825D6':
          layer.feature.properties.mode == 'BICYCLE'     ?   '#4AA6C3':
          '#4AA6C3';
        };

        function polyPopUp(feature, layer) {
          layer.bindPopup( "<b>Origin: </b>"
          + feature.properties.name + "<br>"
          + "<b>Time: </b>"
          + (feature.properties.time/60)
          + " mins");
        }

        function jobCentrePopUp(feature, layer) {
          layer.bindPopup( "<b>Name: </b>"
          + feature.properties.jobcentre_office + "<br>"
          + "<b>ID: </b>"
          + feature.properties.name + "<br>"
          + "<b>Address: </b>"
          + feature.properties.office_address + ", "
          + feature.properties.postcode);
        }

        function sportsStadiumPopUp(feature, layer) {
          layer.bindPopup( "<b>Name: </b>"
          + feature.properties.name + "<br>"
          + "<b>Capacity: </b>"
          + feature.properties.capacity);
        }

        function originPopUp(feature, layer) {
          layer.bindPopup( "<b>Name: </b>"
          + feature.properties.name);
        }

        function lsoaPopUp(feature, layer) {
          layer.bindPopup("<b>Name: </b>" + feature.properties.lsoa11nm + "<br>"
          + "<b>CD: </b>" + feature.properties.lsoa11cd + "<br>"
          + "<b>ID: </b>" + feature.properties.objectid + "<br>"
          + "<b>Population: </b>" + feature.properties.population);
        }

        function pointToPointPopup(feature, layer) {
          layer.bindPopup("<b>Mode: </b>" + feature.properties.mode + "<br>"
          + "<b>Route: </b>" + feature.properties.route + "<br>"
          + "<b>Agency: </b>" + feature.properties.agencyName + "<br>"
          + "<b>Distance: </b>" + (feature.properties.distance/1000).toFixed(2) + " km" + "<br>"
          + "<b>Duration: </b>" + (feature.properties.duration/60).toFixed(2) + " mins");
        }

    </script>

  </div>


  <footer>

    <div class="text">This is a demonstration of some of the outputs <br> made using <a style="color: #f4427a; text-decoration:none" href="https://github.com/datasciencecampus/access-to-services/tree/develop/propeR">propeR</a>, developed and designed <br> by the <a style="color: #1459c9; text-decoration:none" href="https://datasciencecampus.ons.gov.uk/">Data Science Campus</a></div>

    <img id="footerimg" src="images/propeR_logo_v1.png" alt="propeR">
    <img id="footerimg" src="images/data-campus-logo.png" alt="Data Science Campus">
    <img id="footerimg" src="images/ONS-logo.png" alt="Office for National Statistics">

  </footer>

</body>
</html>
